<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java110.cms.dao.SceneReviewDao">

    <resultMap type="sceneReview" id="srMap">
        <id     column="srno"      property="srno"/>
        <result column="mvno"      property="mvno" />
        <result column="mno"       property="mno" />
        <result column="titl"      property="title" />
        <result column="time"      property="time" />
        <result column="phot"      property="photo" />
        <result column="cont"      property="cont" />
        <result column="spo"       property="spo" />
    </resultMap>

    <insert id="insert" parameterType="sceneReview"
            useGeneratedKeys="true" keyColumn="srno" keyProperty="srno">
        INSERT INTO mv_sr(mvno, mno, titl, time, phot, cont, spo, cdt)
        VALUES(#{mvno}, #{mno}, #{title}, #{time}, #{photo}, #{cont}, #{spo}, now())
    </insert>
    
    <insert id="insertCmt" parameterType="sceneReviewCmt"
            useGeneratedKeys="true" keyColumn="cmno" keyProperty="cmno">
        INSERT INTO mv_sr_cmt(srno, mno, phot, cont, cdt)
        VALUES (#{srno}, #{mno}, #{photo}, #{cont}, now())
    </insert>
    
    <select id="findDefaultTime" resultType="string" parameterType="int">
        SELECT time
          FROM mv_sr
         WHERE mvno = #{value}
         ORDER BY time ASC
         LIMIT 1
    </select>
    
    <select id="findByTime" resultMap="srMap" parameterType="map">
        SELECT srno, mvno, mno, titl, time, phot, cont, spo
          FROM mv_sr
         WHERE mvno = #{mvno}
           AND time = #{time}
    </select>
    
    <select id="findByNo" resultMap="srMap" parameterType="int">
        SELECT srno, mvno, mno, titl, time, phot, cont, spo
          FROM mv_sr
         WHERE srno = #{value}
    </select>
    
    <select id="list" resultMap="srMap" parameterType="int">
        SELECT srno, mvno, mno, titl, time, phot, cont, spo
          FROM mv_sr
         WHERE mvno = #{mvno}
         ORDER BY time ASC
    </select>
    
    <update id="signOut" parameterType="int">
        UPDATE IGNORE mv_sr
        SET mno=21
        WHERE mno=#{mno}
    </update>

</mapper>